
// Add your other build.gradle configurations and dependencies here

// Task to update Jira status
tasks.register('updateJiraStatus') {
    doLast {
        def jiraUrl, jiraIssueKey, jiraTransitionId, jiraUsername, jiraPassword

        // Load Jira properties from the project.properties file
        jiraUrl = jiraBaseUrl
        jiraUsername = project.jiraUsername
        jiraPassword = project.jiraPassword

        // Read the details from the jira_details.csv using the path from the project.properties file
        def jiraDetailsPath = project.jiraDetailsPath
        def csvFile = new File(jiraDetailsPath)
        CSVReader reader = new CSVReader(new FileReader(csvFile))
        String[] nextLine
        while ((nextLine = reader.readNext()) != null) {
            def key = nextLine[0]
            def value = nextLine[1]
            switch (key) {
                case 'jiraIssueKey':
                    jiraIssueKey = value
                    break
                case 'jiraTransitionId':
                    jiraTransitionId = value
                    break
                default:
                    println "Unknown key: ${key}"
            }
        }

        def json = "{\"transition\":{\"id\":\"${jiraTransitionId}\"}}"
        def url = "${jiraUrl}/rest/api/2/issue/${jiraIssueKey}/transitions"

        def command = ["curl", "-D-", "-u", "${jiraUsername}:${jiraPassword}", "-X", "PUT", "-H", "Content-Type: application/json", "-d", json, url]
        def process = command.execute()
        process.waitFor()

        println process.text
    }
}